<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Heppy - a very simple example</title>
  <meta name="description" content="Main page for documentation and resources.">

  <link rel="stylesheet" href="http://fccsw.web.cern.ch/fccsw/css/main.css">
  <link rel="canonical" href="http://fccsw.web.cern.ch/fccsw/tutorials/heppy/doc/Heppy_-_a_very_simple_example.html">
  <link rel="alternate" type="application/rss+xml" title="FCCSW" href="http://fccsw.web.cern.ch/fccsw/feed.xml">
</head>


  <body>

    
<header>
   <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://fccsw.web.cern.ch/fccsw/index.html">FCCSW</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li ><a href="http://fccsw.web.cern.ch/fccsw/index.html">Home</a></li>
            <li  class="active" ><a href="http://fccsw.web.cern.ch/fccsw/tutorials">Tutorials</a></li>
            <li><a>Latest Releases:</a></li>
            
            
              
              <li >
                <a href="http://fccsw.web.cern.ch/fccsw/2017/05/15/version081.html">FCCSW v0.8.1</a>
              </li>
              
            
              
              <li >
                <a href="http://fccsw.web.cern.ch/fccsw/2017/03/29/version08.html">FCCSW v0.8</a>
              </li>
              
            
            <li ><a href="http://fccsw.web.cern.ch/fccsw/snapshot.html">Snapshot</a></li>
          </ul>
          <form class="navbar-form navbar-right">
            <div class="input-group">
            <span class="input-group-addon" id="basic-addon1"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></span>
            <input type="text" class="form-control" id="search-input" placeholder="Search" aria-describedby="basic-addon1">
            </div>
          </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

</header>
<div class="container">
  <div class="collapse panel panel-default" id="resultswrap">
      <div class="panel-heading">Search Results <button type="button" class="close" aria-label="Close"><span aria-hidden="true" onclick="$('#resultswrap').collapse('hide');">&times;</span></button></div>
      <ul id="searchresults" class="list-group">
      </ul>
  </div>
</div>

    
    
    <div class="container">
      <div class="col-md-10">
        <h1 id="a-very-simple-heppy-example">A very simple heppy example</h1>

<p>Contents:</p>

<ul>
  <li><a href="#a-very-simple-heppy-example">A very simple heppy example</a>
    <ul>
      <li><a href="#running-the-example">Running the example</a></li>
      <li><a href="#using-python-to-inspect-and-modify-the-configuration">Using python to inspect and modify the configuration</a></li>
      <li><a href="#configuration-file-structure">Configuration file structure</a>
        <ul>
          <li><a href="#importing-a-few-useful-modules">Importing a few useful modules</a></li>
          <li><a href="#definition-of-the-input-events">Definition of the input events</a></li>
          <li><a href="#configuration-of-the-analyzers">Configuration of the analyzers</a></li>
          <li><a href="#scheduling-of-the-event-processing-sequence">Scheduling of the event processing sequence</a></li>
          <li><a href="#definition-of-global-services">Definition of global services</a></li>
          <li><a href="#finalization-of-the-configuration-object">finalization of the configuration object</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>A <a href="../test/simple_example_cfg.py">simple heppy example</a> based on ROOT is provided in the test/ directory.</p>

<h2 id="running-the-example">Running the example</h2>

<p>Please do the following:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>    <span class="nb">cd test</span>/
    <span class="c"># create a root file containing an example root tree:</span>
    python create_tree.py
	 <span class="c"># process this tree:</span>
    heppy_loop.py  Output/ simple_example_cfg.py
</code></pre>
</div>

<p>The two arguments are:</p>

<ul>
  <li>Output/ : The output directory in which the results are stored</li>
  <li><a href="../test/simple_example_cfg.py">simple_example_cfg.py</a> : heppy configuration file</li>
</ul>

<p><strong>Inspection of the ouput</strong></p>

<h2 id="using-python-to-inspect-and-modify-the-configuration">Using python to inspect and modify the configuration</h2>

<p>Heppy configuration files like <a href="../test/simple_example_cfg.py">simple_example_cfg.py</a> are just python modules that can be imported and used in python.</p>

<p>Start python (here we use the superior ipython script):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ipython
</code></pre>
</div>

<p>import the <a href="../test/simple_example_cfg.py">simple_example_cfg.py</a> module:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">heppy.test.simple_example_cfg</span> <span class="kn">import</span> <span class="o">*</span>
</code></pre>
</div>

<p>you can now use the various python objects in cfg_file, e.g. to get help:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">help</span><span class="p">(</span><span class="n">Events</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Help on class Chain in module heppy.framework.chain:

class Chain(__builtin__.object)
 |  Wrapper to TChain, with a python iterable interface.
 |
 |  from chain import Chain
 |  the_chain = Chain('../test/test_*.root', 'test_tree')
 |  event3 = the_chain[2]
 |  print event3.var1
 |
 |  for event in the_chain:
 |      print event.var1
 |
 |  Methods defined here:
 |
 |  __getattr__(self, attr)
 |      All functions of the wrapped TChain are made available
 |
 |  __getitem__(self, index)
 |      Returns the event at position index.
 |
 |  __init__(self, input_filenames, tree_name=None)
 |      Create a chain.
 |
 |      Parameters:
 |        input     = either a list of files or a wildcard (e.g. 'subdir/*.root').
 |                    In the latter case all files matching the pattern will be used
 |                    to build the chain.
 |        tree_name = key of the tree in each file.
 |                    if None and if each file contains only one TTree,
 |                    this TTree is used.
 |
 |  __iter__(self)
 |
 |  __len__(self)
 |
 |  ----------------------------------------------------------------------
 |  Data descriptors defined here:
 |
 |  __dict__
 |      dictionary for instance variables (if defined)
 |
 |  __weakref__
 |      list of weak references to the object (if defined)
</code></pre>
</div>

<p>It is possible to access the attributes and the methods of the various objects, and for example to print them:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">print</span> <span class="n">inputSample</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>Component: test_component
        dataset_entries:   0
        files          :   ['/Users/cbernet/Code/FCC/heppy/doc/test_tree.root']
        isData         :   False
        isEmbed        :   False
        isMC           :   False
        tree_name      :   None
        triggers       :   None
</code></pre>
</div>

<p>It is even possible to use all functionalities of python to prepare your heppy configuration file. For example to use all ROOT files in the current directory as input, one could add the following lines to the configuration file. You may run them now:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">glob</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">'*.root'</span><span class="p">)</span>
<span class="n">inputSample</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">files</span>
<span class="k">print</span> <span class="n">files</span>
</code></pre>
</div>

<h2 id="configuration-file-structure">Configuration file structure</h2>

<p>The goal of the heppy configuration file is to:</p>

<ul>
  <li>specify the input samples of events</li>
  <li>configure the analyzers responsible for event processing</li>
  <li>schedule the event processing sequence</li>
  <li>gather all of this information in a configuration object for hepp</li>
</ul>

<p>These steps are described for <a href="../test/simple_example_cfg.py">simple_example_cfg.py</a>, which is reproduced below.</p>

<h3 id="importing-a-few-useful-modules">Importing a few useful modules</h3>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">heppy.framework.config</span> <span class="kn">as</span> <span class="nn">cfg</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="definition-of-the-input-events">Definition of the input events</h3>

<div class="language-python highlighter-rouge"><pre class="highlight"><code>
<span class="c"># input component</span>
<span class="c"># several input components can be declared,</span>
<span class="c"># and added to the list of selected components</span>

<span class="n">inputSample</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span>
    <span class="s">'test_component'</span><span class="p">,</span>
    <span class="c"># create the test file by running</span>
    <span class="c"># python create_tree.py</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">'test_tree.root'</span><span class="p">)],</span>
    <span class="p">)</span>

<span class="n">selectedComponents</span>  <span class="o">=</span> <span class="p">[</span><span class="n">inputSample</span><span class="p">]</span>

<span class="c"># use a simple event reader based on the ROOT TChain class</span>
<span class="kn">from</span> <span class="nn">heppy.framework.chain</span> <span class="kn">import</span> <span class="n">Chain</span> <span class="k">as</span> <span class="n">Events</span>
</code></pre>
</div>

<p>In this example, we read a single root file using the ROOT TChain class.</p>

<p>One could read a list of files, and even have several input samples (or components), each with its own list of files. Heppy offers the possibility to <a href="Heppy_-_Parallel_Processing.html">process all files of all components in parallel</a>, with a single command.</p>

<p>The Events class here stands for a Chain, which wraps a TChain. It is responsible for reading the events written in the component files. Specific Events classes are provided to read <a href="../framework/eventsfwlite.py">CMS</a>, <a href="https://github.com/HEP-FCC/podio/blob/master/python/EventStore.py">FCC</a>, and <a href="../framework/eventslcio.py">LCIO</a> events.
Other Events classes could be provided e.g for ATLAS events or plain text files such as Les Houches or HepMC events.</p>

<h3 id="configuration-of-the-analyzers">Configuration of the analyzers</h3>

<p>This section of the configuration file specifies the configuration of four very simple analyzers:</p>

<ul>
  <li><a href="../analyzers/examples/simple/RandomAnalyzer.py">RandomAnalyzer</a> : draw a value from a random distribution for a variable and put it into the event.</li>
  <li><a href="../analyzers/examples/simple/Printer.py">Printer</a> : access this variable and print it.</li>
  <li><a href="../analyzers/examples/simple/Stopper.py">Stopper</a> : stop processing at event 10.</li>
  <li><a href="../analyzers/examples/simple/SimpleTreeProducer.py">SimpleTreeProducer</a>: define an output ntuple (TTree) to store the random variable.</li>
</ul>

<p>Please study the sequence below, and the code of each analyzer.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code>
<span class="c"># add a random variable to the event</span>
<span class="kn">from</span> <span class="nn">heppy.analyzers.examples.simple.RandomAnalyzer</span> <span class="kn">import</span> <span class="n">RandomAnalyzer</span>
<span class="n">random</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">Analyzer</span><span class="p">(</span>
    <span class="n">RandomAnalyzer</span>
    <span class="p">)</span>

<span class="c"># just print a variable in the input test tree</span>
<span class="kn">from</span> <span class="nn">heppy.analyzers.examples.simple.Printer</span> <span class="kn">import</span> <span class="n">Printer</span>
<span class="n">printer</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">Analyzer</span><span class="p">(</span>
    <span class="n">Printer</span><span class="p">,</span>
    <span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
    <span class="p">)</span>

<span class="c"># illustrates how to use an exception to stop processing at event 10</span>
<span class="c"># for debugging purposes.</span>
<span class="kn">from</span> <span class="nn">heppy.analyzers.examples.simple.Stopper</span> <span class="kn">import</span> <span class="n">Stopper</span>
<span class="n">stopper</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">Analyzer</span><span class="p">(</span>
    <span class="n">Stopper</span><span class="p">,</span>
    <span class="n">iEv</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="p">)</span>

<span class="c"># creating a simple output tree</span>
<span class="kn">from</span> <span class="nn">heppy.analyzers.examples.simple.SimpleTreeProducer</span> <span class="kn">import</span> <span class="n">SimpleTreeProducer</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">Analyzer</span><span class="p">(</span>
    <span class="n">SimpleTreeProducer</span><span class="p">,</span>
    <span class="n">tree_name</span> <span class="o">=</span> <span class="s">'tree'</span><span class="p">,</span>
    <span class="n">tree_title</span> <span class="o">=</span> <span class="s">'A test tree'</span>
    <span class="p">)</span>
</code></pre>
</div>

<h3 id="scheduling-of-the-event-processing-sequence">Scheduling of the event processing sequence</h3>

<p>The following lines define which analyzers will run, and in which order they will process each event. The <code class="highlighter-rouge">printer</code> and the <code class="highlighter-rouge">stopper</code> are left out from the sequence on purpose. The analyzer <code class="highlighter-rouge">random</code> runs first so that the resulting random variable can be stored in the ntuple by <code class="highlighter-rouge">tree</code> later on.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># definition of a sequence of analyzers,</span>
<span class="c"># the analyzers will process each event in this order</span>
<span class="n">sequence</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">Sequence</span><span class="p">([</span>
        <span class="n">random</span><span class="p">,</span>
        <span class="c"># printer,</span>
        <span class="c"># stopper,</span>
        <span class="n">tree</span><span class="p">,</span>
<span class="p">]</span> <span class="p">)</span>
</code></pre>
</div>

<p>Please include <code class="highlighter-rouge">printer</code> and <code class="highlighter-rouge">stopper</code> to the sequence, and run again.</p>

<h3 id="definition-of-global-services">Definition of global services</h3>

<p><em>Services</em> are created at the beginning of the event processing and can be used in all analyzers. They are usually not needed but are worth mentioning. For example, the service defined below configures a global output root file that can be used by all analyzers. Please note however that each analyzer can also have its own output ROOT file.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">heppy.framework.services.tfile</span> <span class="kn">import</span> <span class="n">TFileService</span>
<span class="n">output_rootfile</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span>
    <span class="n">TFileService</span><span class="p">,</span>
    <span class="s">'myhists'</span><span class="p">,</span>
    <span class="n">fname</span><span class="o">=</span><span class="s">'histograms.root'</span><span class="p">,</span>
    <span class="n">option</span><span class="o">=</span><span class="s">'recreate'</span>
<span class="p">)</span>

<span class="n">services</span> <span class="o">=</span> <span class="p">[</span><span class="n">output_rootfile</span><span class="p">]</span>
</code></pre>
</div>

<h3 id="finalization-of-the-configuration-object">finalization of the configuration object</h3>

<p>A global configuration file named <code class="highlighter-rouge">config</code> must be present. It contains all the information needed by heppy to process your events.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># finalization of the configuration object.</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span> <span class="n">components</span> <span class="o">=</span> <span class="n">selectedComponents</span><span class="p">,</span>
                     <span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">,</span>
                     <span class="n">services</span> <span class="o">=</span> <span class="n">services</span><span class="p">,</span>
                     <span class="n">events_class</span> <span class="o">=</span> <span class="n">Events</span> <span class="p">)</span>

<span class="c"># print config</span>
</code></pre>
</div>

<p>/</p>

      </div>
      <div class="col-md-2">    <ul class="list-group">
        <li class="list-group-header">
            <h4>External links</h4>
        </li>
        
            <li class="list-group-item">
                <a href='http://cern.ch/simba3/SelfSubscription.aspx?groupName=fcc-experiments-sw-dev'>FCCSW Mailing list</a>
            </li>
        
            <li class="list-group-item">
                <a href='http://fccsw.web.cern.ch/fccsw/tutorials/'>FCCSW Tutorials</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/fccsw/issues'>FCCSW Issue Tracker</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/'>FCCSW on GitHub</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://phsft-jenkins.cern.ch/view/FCC/'>FCCSW Jenkins</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/FCCSW/blob/master/doc/CppCodingStyleGuidelines.md'>FCCSW C++ Style Guide</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/FCCSW/blob/master/doc/GeneralCppGuidelines.md'>General C++ Guidelines</a>
            </li>
        
    </ul>
</div>
    </div>
    <script src="http://fccsw.web.cern.ch/fccsw/node_modules/jquery/dist/jquery.min.js" type="text/javascript"></script>
<script src="http://fccsw.web.cern.ch/fccsw/node_modules/bootstrap-sass/assets/javascripts/bootstrap.min.js" type="text/javascript"></script>
<script src="http://fccsw.web.cern.ch/fccsw/node_modules/requirejs/require.js" type="text/javascript"></script>
<script src="http://fccsw.web.cern.ch/fccsw/node_modules/simple-jekyll-search/dest/simple-jekyll-search.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/javascript">
      SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('searchresults'),
        json: 'http://fccsw.web.cern.ch/fccsw/search.json',
        searchResultTemplate: '<li class="list-group-item"><a href="{url}" title="{desc}">{title}</a></li>',
        noResultsText: '<li class="list-group-item">No results found</li>',
        limit: 10,
        fuzzy: false,
        exclude: ['Welcome']
      });
      $("#search-input").keypress(function() {
            $("#resultswrap").collapse('show');
      });
      $("#search-input").keyup(function() {
            if ($(this).val() == "") {
                $("#resultswrap").collapse('hide');
            }
      });
      $("table").each(function(index) {
        $(this).addClass("table");
      });
    </script>


  </body>
</html>
