<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Fcc Full Analysis</title>
  <meta name="description" content="Main page for documentation and resources.">

  <link rel="stylesheet" href="http://fccsw.web.cern.ch/fccsw/css/main.css">
  <link rel="canonical" href="http://fccsw.web.cern.ch/fccsw/tutorials/fcc-tutorials/FccFullAnalysis.html">
  <link rel="alternate" type="application/rss+xml" title="FCCSW" href="http://fccsw.web.cern.ch/fccsw/feed.xml">
</head>


  <body>

    
<header>
   <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://fccsw.web.cern.ch/fccsw/index.html">FCCSW</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li ><a href="http://fccsw.web.cern.ch/fccsw/index.html">Home</a></li>
            <li  class="active" ><a href="http://fccsw.web.cern.ch/fccsw/tutorials">Tutorials</a></li>
            <li><a>Latest Releases:</a></li>
            
            
              
              <li >
                <a href="http://fccsw.web.cern.ch/fccsw/2017/05/15/version081.html">FCCSW v0.8.1</a>
              </li>
              
            
              
              <li >
                <a href="http://fccsw.web.cern.ch/fccsw/2017/03/29/version08.html">FCCSW v0.8</a>
              </li>
              
            
            <li ><a href="http://fccsw.web.cern.ch/fccsw/snapshot.html">Snapshot</a></li>
          </ul>
          <form class="navbar-form navbar-right">
            <div class="input-group">
            <span class="input-group-addon" id="basic-addon1"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></span>
            <input type="text" class="form-control" id="search-input" placeholder="Search" aria-describedby="basic-addon1">
            </div>
          </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

</header>
<div class="container">
  <div class="collapse panel panel-default" id="resultswrap">
      <div class="panel-heading">Search Results <button type="button" class="close" aria-label="Close"><span aria-hidden="true" onclick="$('#resultswrap').collapse('hide');">&times;</span></button></div>
      <ul id="searchresults" class="list-group">
      </ul>
  </div>
</div>

    
    
    <div class="container">
      <div class="col-md-10">
        <h1 id="fcc-pythia--delphes--heppy-analysis"><a href=""></a> FCC Pythia + Delphes + Heppy Analysis</h1>

<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#generate-events">Generate and Simulate Events</a></li>
  <li><a href="#analyze-events">Analyze Events</a></li>
  <li><a href="#plot-events">Plot events</a></li>
  <li><a href="#homework-exercise">Homework exercise</a></li>
</ul>

<h2 id="overview"><a href=""></a> Overview</h2>

<p>This tutorial will teach you how to:</p>

<ul>
  <li><strong>generate</strong> signal and background samples with <strong>Pythia8</strong> within FCCSW</li>
  <li>run a fast parametric <strong>detector simulation</strong> with <strong>Delphes</strong> within FCCSW</li>
  <li>apply an <strong>event selection</strong> on those samples with <strong>Heppy</strong></li>
  <li>produce <strong>flat ntuples</strong> with observables of interest with Heppy</li>
  <li>produce plots</li>
</ul>

<p><strong>This tutorial has been tested on bash shells. It is not guaranteed to work on other shells.</strong></p>

<h2 id="part-i-generate-and-simulate-events-with-fccsw"><a href=""></a>Part I: Generate and simulate Events with FCCSW</h2>

<p>First, log into lxplus, and <strong>install the FCC software</strong>, using <a href="./FccSoftwareGit.html">git</a>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>git clone https://github.com/HEP-FCC/FCCSW.git
cd FCCSW
source ./init.sh
make -j 12
</code></pre>
</div>

<p>For this tutorial we will consider the following <strong>physics processes</strong>:</p>

<ul>
  <li>p p -&gt; H -&gt; 4 l</li>
  <li>p p -&gt; Z/gamma Z/gamma -&gt; 4 l</li>
</ul>

<p>Pythia can be configured to hadronize previously generated hard scattering in the form of Les Houches event files (.lhe),
or generate the hard process itself and then run the parton shower and hadronization. <strong>In either case, the FCCSW takes
as input a Pythia8 configuration file</strong> (.cmd), and does not need to know which approach was used.</p>

<p>For this tutorial, we are going to run Pythia8 on previously produced LHE files (with <a href="https://launchpad.net/mg5amcnlo">MG5_aMCatNLO</a>). Additional Pythia8
configurations are present in <code class="highlighter-rouge">Generation/data</code>.</p>

<p>The following commands will run Pythia8 and Delphes and produce the relevant signal and background samples:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>./run fccrun.py Sim/SimDelphesInterface/options/PythiaDelphes_config.py --inputfile=Generation/data/Pythia_pp_h_4l.cmd --outputfile=pp_h_4l.root --nevents=1000
./run fccrun.py Sim/SimDelphesInterface/options/PythiaDelphes_config.py --inputfile=Generation/data/Pythia_pp_zgzg_4l.cmd --outputfile=pp_zgzg_4l.root --nevents=1000
</code></pre>
</div>

<p>The <code class="highlighter-rouge">--inputfile</code> , <code class="highlighter-rouge">--outputfile</code> and <code class="highlighter-rouge">--nevents</code> options simply overwrite parameters that are defined in the main
configuration <code class="highlighter-rouge">Sim/SimDelphesInterface/options/PythiaDelphes_config.py</code>. For a complete discussion on the structure of configuration file, see <a href="../FCCSW/Sim/SimDelphesInterface/doc/FccPythiaDelphes.html">this page</a>.
Aside from I/O and number of events (which can be specified through command line),
for most use cases as a user you won’t need to apply any change to the configuration file.</p>

<p>In addition to the <strong>sequence of modules</strong> to be executed, and which <strong>output collections</strong> to be stored in the output tree, the following
parameters can be specified via the configuration file:</p>

<ul>
  <li><code class="highlighter-rouge">nEvents</code> –&gt; number
of events to be simulated</li>
  <li><code class="highlighter-rouge">pythiaConfFile</code> –&gt;
Pythia8 configuration file</li>
  <li><code class="highlighter-rouge">delphescard</code> –&gt;
Delphes detector card</li>
  <li><code class="highlighter-rouge">out.filename</code> –&gt;
name of output file</li>
</ul>

<p>In this example, Delphes is run on the fly with the baseline FCC-hh detector configuration.
Other detector cards can be found in the <code class="highlighter-rouge">$DELPHES_DIR/cards</code> directory, such as a ATLAS, CMS or ILD detector configurations:
<code class="highlighter-rouge">delphes_card_ATLAS.tcl</code>, <code class="highlighter-rouge">delphes_card_CMS.tcl</code> and  <code class="highlighter-rouge">delphes_card_ILD.tcl</code>. Many of the questions you might have on Delphes Fast Simulation are probably answered
<a href="https://cp3.irmp.ucl.ac.be/projects/delphes/wiki/WorkBook">here</a>.</p>

<p>Now overwrite the samples you just produced, with larger samples (10k events) that have been previously produced and stored in eos.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>export EOS_MGM_URL="root://eospublic.cern.ch"
source /afs/cern.ch/project/eos/installation/client/etc/setup.sh
eos cp /eos/fcc/hh/tutorials/Higgs_4l/pp_h_4l.root .
eos cp /eos/fcc/hh/tutorials/Higgs_4l/pp_zgzg_4l.root .
</code></pre>
</div>

<p>The output is a ROOT file containing a tree in the FCC <a href="https://github.com/HEP-FCC/fcc-edm">Event Data Model structure</a>. It is browsable with ROOT:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>root -l pp_h_4l.root
TBrowser t;
</code></pre>
</div>

<p>Plotting some basic quantities directly on this output is possible, although not very handy:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>events-&gt;Draw("sqrt(electrons[0].core.p4.px*electrons[0].core.p4.px + electrons[0].core.p4.py*electrons[0].core.p4.py)")
gPad-&gt;SetLogy()
</code></pre>
</div>

<p><img src="./images/FccFullAnalysis/ele1_pt.png" width="400" /></p>

<h2 id="part-ii-analyze-the-output-with-heppy"><a href=""></a>Part II: Analyze the output with Heppy</h2>

<p><a href="https://github.com/HEP-FCC/heppy">Heppy</a> is a python framework suitable for analyzing the FCCSW output.</p>

<p>First install HEPPY:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>git clone https://github.com/HEP-FCC/heppy.git
cd heppy
source init.sh
cd ..
</code></pre>
</div>

<p>Understand the configuration file for this <strong>H-&gt;4l analysis</strong>: <code class="highlighter-rouge">heppy/test/analysis_pp_hTo4l_simple_cfg.py</code>
This is where <strong>filters</strong> on input collections and <strong>event selection</strong> are defined.
The sequence is divided in two parts, a gen level analysis, and a reco level.</p>

<ul>
  <li>The <strong>gen level analysis</strong> simply filters interesting leptons (<code class="highlighter-rouge">gen_leptons</code>) and stores pT, eta in in flat tree (<code class="highlighter-rouge">gen_tree</code>).</li>
</ul>

<p>Have a look at the corresponding code in <code class="highlighter-rouge">heppy/analyzers/examples/hzz4l/HTo4lGenTreeProducer.py</code>.</p>

<ul>
  <li>The <strong>reco level analysis</strong> first <strong>selects isolated leptons</strong> (<code class="highlighter-rouge">selected_muons</code>, <code class="highlighter-rouge">selected_electrons</code>), merges them into a single collection (<code class="highlighter-rouge">selected_leptons</code>),
<strong>builds Z candidates</strong> (<code class="highlighter-rouge">zeds</code>) and finally <strong>builds higgs candidates</strong>  (<code class="highlighter-rouge">higgses</code>). After that an <strong>event selection</strong> is applied (<code class="highlighter-rouge">selection</code>).</li>
</ul>

<p>Open <code class="highlighter-rouge">heppy/analyzers/examples/hzz4l/selection.py</code> and understand the event selection.</p>

<p>Finally another flat tree is produced <code class="highlighter-rouge">HTo4lTreeProducer</code>.
This tree contains contains all relevant information for the two reconstructed Z bosons, the Higgs, and the four associated leptons.
For comparison, also the MC level counterparts of the reconstructed quantities are stored.</p>

<p>To summarize, when designing a new analysis, you will have to define:</p>

<ul>
  <li>a configuration file containing the analysis sequence</li>
  <li>an event selection</li>
  <li>one or several tree producer(s) where the variables to be stored in the output tree(s) are specified</li>
  <li>optionally, new modules that are specific to your analysis (e.g. <code class="highlighter-rouge">LeptonicZedBuilder</code> here)</li>
</ul>

<p>Now run HEPPY:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>heppy_loop.py pp_h_4l heppy/test/analysis_pp_hTo4l_simple_cfg.py -N 10000 -I pp_h_4l.root;
heppy_loop.py pp_zgzg_4l heppy/test/analysis_pp_hTo4l_simple_cfg.py -N 10000 -I pp_zgzg_4l.root;
</code></pre>
</div>
<p>The runs create two output directories <code class="highlighter-rouge">pp_h_4l</code> and <code class="highlighter-rouge">pp_zgzg_4l</code>, with various subdirectories. The breakdown of
efficiencies by cut can be found in:</p>

<p><code class="highlighter-rouge">example/heppy.analyzers.examples.hzz4l.selection.Selection_cuts/cut_flow.txt</code></p>

<p>The <strong>gen-level</strong> and <strong>reco-level</strong> output trees can be found here:</p>

<p><code class="highlighter-rouge">example/heppy.analyzers.examples.hzz4l.HTo4lGenTreeProducer.HTo4lGenTreeProducer_1/tree.root</code>
<code class="highlighter-rouge">example/heppy.analyzers.examples.hzz4l.HTo4lTreeProducer.HTo4lTreeProducer_1/tree.root</code></p>

<h2 id="part-iii-produce-plots"><a href=""></a>Part III: Produce plots</h2>

<p>Download the python code:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>git clone https://github.com/selvaggi/tutorials.git
</code></pre>
</div>

<p>Produce Gen-level plots:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>python tutorials/fcc/createGenHistos.py
eog plots/lep*.png
</code></pre>
</div>

<p><img src="./images/FccFullAnalysis/lep1vsPt_pt.png" width="400" />
<img src="./images/FccFullAnalysis/lep1vsEta_eta.png" width="400" /></p>

<p>Produce Reco-level plots:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>python tutorials/fcc/createRecoHistos.py
eog plots/*_m.png
</code></pre>
</div>

<p>Appreciate the signal yield for <strong>25 fb-1 of data</strong>. Compare with <a href="https://arxiv.org/pdf/1408.5191v3.pdf">ATLAS results</a> at 7,8 TeV .</p>

<p><img src="./images/FccFullAnalysis/higgs_m.png" width="400" />
<img src="./images/FccFullAnalysis/m4l_80_170_allYear_125.png" width="400" /></p>

<h2 id="part-iv-homework"><a href=""></a>Part IV: Homework</h2>

<p>As an exercise you can <strong>re-run the full analysis with the CMS detector configuration</strong> .Additional Delphes card can
be found in <code class="highlighter-rouge">$DELPHES_DIR/cards</code>).</p>

<p>Hint: The input Delphes card can be specified in the command line argument: 
<code class="highlighter-rouge">
--delphescard=$DELPHES_DIR/cards/delphes_card_CMS.tcl
</code></p>

<p>You should obtain a plot similar to the following:</p>

<p><img src="./images/FccFullAnalysis/higgs_m_cms.png" width="400" /></p>

<p>By comparing the CMS and FCC Delphes cards, try to explain:</p>

<ul>
  <li>the <strong>event yields difference between 7/8 TeV and 100 TeV</strong> (by comparing the official ATLAS plot with the CMS configuration you just ran at 100 TeV)</li>
  <li>the <strong>event yields difference at 100 TeV</strong> between the CMS and FCC detector configurations</li>
  <li>the <strong>difference in the width of Z and H peaks</strong> between the CMS and FCC detector configurations</li>
</ul>

<h2 id="other-documentation"><a href=""></a> Other documentation</h2>

<ul>
  <li><a href="../fcc-tutorials/FccCondor.html">Submit FCCSW jobs using the condor queue</a></li>
  <li><a href="../heppy/doc/Heppy_-_Parallel_Processing.html">Submit Heppy jobs using the batch queue</a></li>
  <li><a href="http://fccsw.web.cern.ch/fccsw/index.html">FCCSW webpage</a></li>
  <li><a href="http://home.thep.lu.se/~torbjorn/pythia81html/Welcome.html">Pythia8 manual</a></li>
  <li><a href="https://cp3.irmp.ucl.ac.be/projects/delphes">Delphes website</a></li>
</ul>

<hr />


      </div>
      <div class="col-md-2">    <ul class="list-group">
        <li class="list-group-header">
            <h4>External links</h4>
        </li>
        
            <li class="list-group-item">
                <a href='http://cern.ch/simba3/SelfSubscription.aspx?groupName=fcc-experiments-sw-dev'>FCCSW Mailing list</a>
            </li>
        
            <li class="list-group-item">
                <a href='http://fccsw.web.cern.ch/fccsw/tutorials/'>FCCSW Tutorials</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/fccsw/issues'>FCCSW Issue Tracker</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/'>FCCSW on GitHub</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://phsft-jenkins.cern.ch/view/FCC/'>FCCSW Jenkins</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/FCCSW/blob/master/doc/CppCodingStyleGuidelines.md'>FCCSW C++ Style Guide</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/FCCSW/blob/master/doc/GeneralCppGuidelines.md'>General C++ Guidelines</a>
            </li>
        
    </ul>
</div>
    </div>
    <script src="http://fccsw.web.cern.ch/fccsw/node_modules/jquery/dist/jquery.min.js" type="text/javascript"></script>
<script src="http://fccsw.web.cern.ch/fccsw/node_modules/bootstrap-sass/assets/javascripts/bootstrap.min.js" type="text/javascript"></script>
<script src="http://fccsw.web.cern.ch/fccsw/node_modules/requirejs/require.js" type="text/javascript"></script>
<script src="http://fccsw.web.cern.ch/fccsw/node_modules/simple-jekyll-search/dest/simple-jekyll-search.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/javascript">
      SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('searchresults'),
        json: 'http://fccsw.web.cern.ch/fccsw/search.json',
        searchResultTemplate: '<li class="list-group-item"><a href="{url}" title="{desc}">{title}</a></li>',
        noResultsText: '<li class="list-group-item">No results found</li>',
        limit: 10,
        fuzzy: false,
        exclude: ['Welcome']
      });
      $("#search-input").keypress(function() {
            $("#resultswrap").collapse('show');
      });
      $("#search-input").keyup(function() {
            if ($(this).val() == "") {
                $("#resultswrap").collapse('hide');
            }
      });
      $("table").each(function(index) {
        $(this).addClass("table");
      });
    </script>


  </body>
</html>
