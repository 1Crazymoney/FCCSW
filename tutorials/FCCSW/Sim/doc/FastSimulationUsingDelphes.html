<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Fast Simulation Using Delphes</title>
  <meta name="description" content="Main page for documentation and resources.">

  <link rel="stylesheet" href="http://fccsw.web.cern.ch/fccsw/css/main.css">
  <link rel="canonical" href="http://fccsw.web.cern.ch/fccsw/tutorials/FCCSW/Sim/doc/FastSimulationUsingDelphes.html">
  <link rel="alternate" type="application/rss+xml" title="FCCSW" href="http://fccsw.web.cern.ch/fccsw/feed.xml">
</head>


  <body>

    
<header>
   <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://fccsw.web.cern.ch/fccsw/index.html">FCCSW</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li ><a href="http://fccsw.web.cern.ch/fccsw/index.html">Home</a></li>
            <li  class="active" ><a href="http://fccsw.web.cern.ch/fccsw/tutorials">Tutorials</a></li>
            <li><a>Latest Releases:</a></li>
            
            
              
              <li >
                <a href="http://fccsw.web.cern.ch/fccsw/2017/05/15/version081.html">FCCSW v0.8.1</a>
              </li>
              
            
              
              <li >
                <a href="http://fccsw.web.cern.ch/fccsw/2017/03/29/version08.html">FCCSW v0.8</a>
              </li>
              
            
            <li ><a href="http://fccsw.web.cern.ch/fccsw/snapshot.html">Snapshot</a></li>
          </ul>
          <form class="navbar-form navbar-right">
            <div class="input-group">
            <span class="input-group-addon" id="basic-addon1"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></span>
            <input type="text" class="form-control" id="search-input" placeholder="Search" aria-describedby="basic-addon1">
            </div>
          </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

</header>
<div class="container">
  <div class="collapse panel panel-default" id="resultswrap">
      <div class="panel-heading">Search Results <button type="button" class="close" aria-label="Close"><span aria-hidden="true" onclick="$('#resultswrap').collapse('hide');">&times;</span></button></div>
      <ul id="searchresults" class="list-group">
      </ul>
  </div>
</div>

    
    
    <div class="container">
      <div class="col-md-10">
        <h1 id="fast-simulation-using-delphes">Fast Simulation Using Delphes</h1>

<p>Contents</p>

<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#installation-procedure">Installation Procedure</a></li>
  <li><a href="#what-is-delphes">What is Delphes?</a></li>
  <li><a href="#running-delphes-in-fccsw">Running Delphes in FCCSW</a>
    <ul>
      <li><a href="#fccsw-configuration-file">FCCSW configuration file</a></li>
      <li><a href="#delphes-card">Delphes card</a></li>
    </ul>
  </li>
  <li><a href="#fcc-edm-output">FCC-EDM output</a></li>
  <li><a href="#other-documentation">Other documentation</a></li>
</ul>

<h2 id="overview">Overview</h2>

<p>This is a technical description of the Delphes interface in FCCSW. It describes the configuration file of FCCSW and properties
that allow customisation of the Delphes job. We also have dedicated tutorials to
<a href="https://github.com/HEP-FCC/fcc-tutorials/blob/master/FccSoftwareGettingStartedFastSim.md#getting-started-with-delphes-fcc-hh">get started with Delphes</a> and
<a href="../fcc-tutorials/FccFullAnalysis.html">run a full analysis using Delphes fast simulation</a>.</p>

<h2 id="introduction">Introduction</h2>

<p><strong>A small tutorial on how to study FCC-hh benchmark channels</strong> within
the <strong><a href="https://github.com/HEP-FCC/FCCSW">FCCSW framework</a></strong> with
<strong><a href="http://home.thep.lu.se/~torbjorn/pythia81html/Welcome.html">Pythia</a></strong>
generator, <strong><a href="https://cp3.irmp.ucl.ac.be/projects/delphes">Delphes</a></strong> simulation, and
<strong><a href="https://github.com/cbernet/heppy">Heppy</a></strong> analysis framework.</p>

<p>The event generation (Pythia8) and the detector simulation (Delphes) are handled by the FCCSW.
Heppy is then configured used to apply an event selection, and produce a flat ROOT tree containing
the observables that are relevant for the physics channel under study.</p>

<h2 id="installation-procedure">Installation Procedure</h2>

<p>The fast simulation is run within the <strong>FCCSW framework</strong>, based on <strong>Gaudi</strong>. For installation instructions of FCCSW see
<a href="../FCCSW/README.html">FCCSW installation instructions</a>.</p>

<h2 id="what-is-delphes">What is Delphes</h2>

<p>To get familiar with the <strong>Delphes software</strong> , follow a <a href="https://cp3.irmp.ucl.ac.be/projects/delphes/wiki/WorkBook/QuickTour">quick tour</a>
on the Delphes official web page. Let us stress that the Delphes card needs to be compatible with the Delphes software
version. Only in such case, the support for parametrization and physics object output of all Delphes modules can be
guaranteed!</p>

<h2 id="description-of-the-workflow-with-delphes-in-fccsw">Description of the Workflow with Delphes in FCCSW</h2>

<ul>
  <li>
    <p>The Pythia input is defined through <a href="https://en.wikipedia.org/wiki/Les_Houches_Accords">LHE</a> (Les Houches Event)
data file. Additionally Pythia is configured through a config file (details see below).</p>
  </li>
  <li>
    <p>In FCCSW the Pythia output is propagated to Delphes with the <a href="http://lcgapp.cern.ch/project/simu/HepMC/">HepMC</a>
event data format.</p>
  </li>
  <li>
    <p>We can either use Pythia and Delphes in the same job or alternatively read a
<a href="http://lcgapp.cern.ch/project/simu/HepMC/">HepMC</a> data file.</p>
  </li>
  <li>
    <p>Each event is passed to Delphes which takes care of the simulation and outputs collections and relations of various
physics objects.</p>
  </li>
  <li>
    <p>The Delphes output objects (collections, relations) are translated into the <strong><a href="../fcc-edm/README.html">FCC-EDM</a></strong>
(FCC event-data model) and written into a ROOT file. Thus, can be then easily processed by ROOT macros.</p>
  </li>
  <li>
    <p>In addition, for backwards compatibility and/or testing purposes the Delphes output is also supported. The output is
a ROOT tree, using standard Delphes ROOT tree writer.</p>
  </li>
</ul>

<p>Program workflow:</p>

<p><img src="https://twiki.cern.ch/twiki/pub/FCC/FccPythiaDelphes/PythiaDelphes_ZDrasal_Scheme.jpg" alt="PythiaDelphes_ZDrasal_Scheme.jpg" title="PythiaDelphes_ZDrasal_Scheme.jpg" /></p>

<h2 id="running-delphes-in-fccsw">Running Delphes in FCCSW</h2>

<p>The example can be run with:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>./run gaudirun.py Sim/SimDelphesInterface/options/PythiaDelphes_config.py
</code></pre>
</div>

<p>After the job finishes you should see a file <code class="highlighter-rouge">FCCDelphesOutput.root</code>. Details about the contents of this file may be found
<a href="#fcc-edm-output">below</a>. Two configurations govern what actually happens in the generation and fast simulation:</p>

<ol>
  <li>FCCSW python configuration (that schedules Pythia and Delphes)</li>
  <li>The Delphes card</li>
</ol>

<blockquote>
  <p>Details about the Pythia configuration, can be found <a href="../../Generation/doc/RunningPythia.html">here</a>.</p>
</blockquote>

<h3 id="fccsw-configuration-file">FCCSW configuration file</h3>

<p>The FCCSW configuration file (python script) to run Pythia &amp; Delphes in one job:</p>

<p><strong><a href="https://github.com/HEP-FCC/FCCSW/blob/master/Sim/SimDelphesInterface/options/PythiaDelphes_config.py">PythiaDelphes_config.py</a></strong> -
Parameters of interest:</p>

<ul>
  <li><code class="highlighter-rouge">nEvents</code> –&gt; events to be simulated</li>
  <li><code class="highlighter-rouge">messageLevel</code> –&gt; GAUDI messaging
verbosity: ERROR, WARNING, INFO, DEBUG, … –&gt; use WARNING
or INFO</li>
  <li><code class="highlighter-rouge">pythiaconfFile</code> –&gt; Pythia
configuration file (use either Pythia_LHEinput.cmd
or Pythia_standard.cmd)</li>
  <li><code class="highlighter-rouge">delphesCard</code> –&gt; Delphes
configuration file (use official Delphes card)</li>
  <li><code class="highlighter-rouge">delphesHepMCInFile</code> –&gt; Delphes
input file (use “” to read <span class="twikiNewLink"> HepMC
</span> directly from Pythia, i.e. from transient data store)</li>
  <li><code class="highlighter-rouge">delphesRootOutFile</code> –&gt; Delphes
output file (use “” to avoid extra output with Delphes objects
to ROOT file, FCC-EDM objects automatically written out!)</li>
  <li><code class="highlighter-rouge">delphesXXXOutArray</code> –&gt; Define
Delphes output arrays to be processed as FCC-EDM XXX particles
(muons, electrons, etc.) –&gt; various Delphes modules provide
the same type of particle with different level of processing.
(For better understanding, watch the content of the Delphes card
and search e.g. for muons to see how individual Delphes modules
work out muon particles. Focus on
<code class="highlighter-rouge">OutputArray</code> variable.)</li>
</ul>

<h3 id="delphes-card">Delphes card</h3>

<p>Some cards are located in the
<a href="https://github.com/HEP-FCC/FCCSW/tree/master/Sim/SimDelphesInterface/data">Sim/SimDelphesInterface/data</a>
directory:</p>

<ul>
  <li><strong><a href="https://github.com/HEP-FCC/FCCSW/blob/master/Sim/SimDelphesInterface/data/FCChh_DelphesCard_Baseline_v01.tcl">FCChh_DelphesCard_Baseline_v01.tcl</a></strong>:
Official FCChh Delphes configuration card, defining sequence of Delphes modules to be executed and detector characterization.</li>
</ul>

<p>(more to come)</p>

<h2 id="fcc-edm-output">FCC-EDM output</h2>

<p>The following collections and relations will be saved in the output
file. Each collection (relation) is handled in the FCCSW through a
dedicated handle. To get an idea on the EDM, have a look at the <a href="https://github.com/HEP-FCC/fcc-edm/blob/master/edm.yaml">yaml</a> file.
For reference, the handle name (specified in a
<a href="https://github.com/HEP-FCC/FCCSW/blob/master/Sim/SimDelphesInterface/options/PythiaDelphes_config.py">DelphesPythia_config.py</a>
file) is given in the brackets [] below:</p>

<ul>
  <li><strong>Collections:</strong>
    <ul>
      <li><code class="highlighter-rouge">fcc::MCParticleCollection</code>:  generated particles <code class="highlighter-rouge">[genParticles]</code></li>
      <li><code class="highlighter-rouge">fcc::GenVertexCollection</code>: generated vertices <code class="highlighter-rouge">[genVertices]</code></li>
      <li><code class="highlighter-rouge">fcc::GenJetCollection</code>: generated jets <code class="highlighter-rouge">[genJets]</code></li>
      <li><code class="highlighter-rouge">fcc::ParticleCollection</code>: reconstructed muons <code class="highlighter-rouge">[muons]</code>, electrons <code class="highlighter-rouge">[electrons]</code>, charged particles <code class="highlighter-rouge">[charged]</code>,
neutral particles <code class="highlighter-rouge">[neutral]</code>, photons <code class="highlighter-rouge">[photons]</code> and jet constituents <code class="highlighter-rouge">[jetParts]</code></li>
      <li><code class="highlighter-rouge">fcc::JetCollection</code>: reconstructed jets <code class="highlighter-rouge">[jets]</code></li>
      <li><code class="highlighter-rouge">fcc::METCollection</code>: reconstructed missing Et <code class="highlighter-rouge">[met]</code></li>
      <li><code class="highlighter-rouge">fcc::TaggedJetCollection</code>: collection of reconstructed tagged jets - b-tags, c-tags and tau-tags, holds a relation to the original jet
<code class="highlighter-rouge">[bTags, cTags, tauTags]</code></li>
      <li><code class="highlighter-rouge">fcc::TaggedParticleCollection</code>: collection reconstructed isolation tag info for electrons, muons and
photons, holds a relation to the original particle <code class="highlighter-rouge">[muonITags, electronITags, photonITags]</code></li>
    </ul>
  </li>
  <li><strong>Relations:</strong>
    <ul>
      <li><code class="highlighter-rouge">fcc::ParticleMCParticleAssociationCollection</code>: relations of reconstructed object to MC particle for
muons <code class="highlighter-rouge">[muonsToMC]</code> , electrons <code class="highlighter-rouge">[electronsToMC]</code>, charged particles <code class="highlighter-rouge">[chargedToMC]</code> , neutral particles
<code class="highlighter-rouge">[neutralToMC]</code> and photons <code class="highlighter-rouge">[photonsToMC]</code></li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="other-documentation">Other documentation</h2>

<p>Tutorials on using Delphes for FCC-hh:</p>

<ul>
  <li><a href="https://github.com/HEP-FCC/fcc-tutorials/blob/master/FccSoftwareGettingStartedFastSim.md#getting-started-with-delphes-fcc-hh">Getting started with Delphes (FCC-hh)</a></li>
  <li><a href="../fcc-tutorials/FccFullAnalysis.html">A FCC Pythia + Delphes + Heppy Analysis</a></li>
</ul>

<p>Some presentations on this topic may be found here:</p>

<ul>
  <li><a href="https://indico.cern.ch/event/446602/contribution/6/attachments/1238094/1818990/PythiaDelphes_ZDrasal.pdf">Talk</a>
(FCC-hh group) on Mar 3rd 2016</li>
  <li><a href="https://indico.cern.ch/event/443015/contribution/2/attachments/1155286/1660371/PythiaDelphes_ZDrasal.pdf">Talk</a>
(FCC-hh group) on Sep 15th 2015</li>
  <li><a href="https://indico.cern.ch/event/399484/contribution/0/attachments/800169/1096662/FCCSW_MDG_040615.pdf">Talk</a>
(FCC software group) on Jun 4th 2015</li>
  <li><a href="https://indico.cern.ch/event/370378/contribution/2/attachments/736634/1010596/FCCSW_MDG_050215.pdf">Talk</a>
(FCC sofware group) on Feb 5th 2015</li>
</ul>

<hr />


      </div>
      <div class="col-md-2">    <ul class="list-group">
        <li class="list-group-header">
            <h4>External links</h4>
        </li>
        
            <li class="list-group-item">
                <a href='http://cern.ch/simba3/SelfSubscription.aspx?groupName=fcc-experiments-sw-dev'>FCCSW Mailing list</a>
            </li>
        
            <li class="list-group-item">
                <a href='http://fccsw.web.cern.ch/fccsw/tutorials/'>FCCSW Tutorials</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/fccsw/issues'>FCCSW Issue Tracker</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/'>FCCSW on GitHub</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://phsft-jenkins.cern.ch/view/FCC/'>FCCSW Jenkins</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/FCCSW/blob/master/doc/CppCodingStyleGuidelines.md'>FCCSW C++ Style Guide</a>
            </li>
        
            <li class="list-group-item">
                <a href='https://github.com/HEP-FCC/FCCSW/blob/master/doc/GeneralCppGuidelines.md'>General C++ Guidelines</a>
            </li>
        
    </ul>
</div>
    </div>
    <script src="http://fccsw.web.cern.ch/fccsw/node_modules/jquery/dist/jquery.min.js" type="text/javascript"></script>
<script src="http://fccsw.web.cern.ch/fccsw/node_modules/bootstrap-sass/assets/javascripts/bootstrap.min.js" type="text/javascript"></script>
<script src="http://fccsw.web.cern.ch/fccsw/node_modules/requirejs/require.js" type="text/javascript"></script>
<script src="http://fccsw.web.cern.ch/fccsw/node_modules/simple-jekyll-search/dest/simple-jekyll-search.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/javascript">
      SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('searchresults'),
        json: 'http://fccsw.web.cern.ch/fccsw/search.json',
        searchResultTemplate: '<li class="list-group-item"><a href="{url}" title="{desc}">{title}</a></li>',
        noResultsText: '<li class="list-group-item">No results found</li>',
        limit: 10,
        fuzzy: false,
        exclude: ['Welcome']
      });
      $("#search-input").keypress(function() {
            $("#resultswrap").collapse('show');
      });
      $("#search-input").keyup(function() {
            if ($(this).val() == "") {
                $("#resultswrap").collapse('hide');
            }
      });
      $("table").each(function(index) {
        $(this).addClass("table");
      });
    </script>


  </body>
</html>
